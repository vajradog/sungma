<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#050507">
  <meta name="description" content="Sungma â€” Privacy camera for activists. Real-time face pixelation, no server, no account.">
  <title>Sungma</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-icon">
        <svg width="56" height="56" viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="28" stroke="#10b981" stroke-width="2" fill="none" opacity="0.3"/>
          <circle cx="32" cy="32" r="28" stroke="#10b981" stroke-width="2" fill="none" stroke-dasharray="20 10"/>
          <circle cx="32" cy="24" r="7" stroke="#10b981" stroke-width="2" fill="none"/>
          <path d="M18 46c0-7.732 6.268-14 14-14s14 6.268 14 14" stroke="#10b981" stroke-width="2" fill="none" stroke-linecap="round"/>
          <line x1="21" y1="21" x2="43" y2="43" stroke="#10b981" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
      <h1 class="loading-title">Sungma</h1>
      <p class="loading-tagline">Privacy camera for activists</p>
      <p class="loading-subtitle">Initializing face detection...</p>
      <div class="loading-bar"><div class="loading-bar-fill"></div></div>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="app hidden">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <span class="app-name">Sungma</span>
        <div class="trust-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          <span>On-Device</span>
        </div>
      </div>
      <div class="header-right">
        <button id="btn-settings" class="icon-btn" aria-label="Settings" title="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        </button>
        <button id="btn-flip-camera" class="icon-btn" aria-label="Flip camera" title="Flip camera">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
        </button>
      </div>
    </header>

    <!-- Viewfinder -->
    <div class="viewfinder-container">
      <video id="video" autoplay playsinline muted></video>
      <video id="video-pip" autoplay playsinline muted></video>
      <canvas id="canvas"></canvas>
      <div id="face-count" class="face-count hidden">0 faces detected</div>
      <div id="recording-indicator" class="recording-indicator hidden">
        <span class="rec-dot"></span>
        <span id="rec-timer">00:00</span>
      </div>
      <!-- Permission / Error States -->
      <div id="camera-prompt" class="camera-overlay hidden">
        <div class="camera-overlay-content">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
          <p id="camera-prompt-text">Camera access is needed for real-time face protection. All processing stays on your device.</p>
          <button id="btn-allow-camera" class="btn btn-primary">Allow Camera</button>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="controls-area">
      <!-- Quick Toggles Row -->
      <div class="quick-toggles">
        <button id="btn-distortion" class="distortion-toggle" aria-label="Toggle voice distortion">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          <span id="distortion-label">Distort: OFF</span>
        </button>
        <div class="cover-style-bar" id="cover-style-bar">
          <button class="cover-chip" data-style="light">Light</button>
          <button class="cover-chip active" data-style="medium">Medium</button>
          <button class="cover-chip" data-style="heavy">Heavy</button>
          <button class="cover-chip" data-style="blackbox">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="2" width="20" height="20" rx="4"/></svg>
            Block
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-bar">
        <button id="btn-photo" class="action-btn photo-btn" aria-label="Take photo" title="Take photo">
          <div class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
          </div>
          <span>Photo</span>
        </button>
        <button id="btn-record" class="action-btn record-btn" aria-label="Record video" title="Record video">
          <div class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3.5" fill="currentColor"/></svg>
          </div>
          <span>Record</span>
        </button>
        <button id="btn-audio" class="action-btn audio-btn" aria-label="Record audio" title="Record audio">
          <div class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          </div>
          <span>Audio</span>
        </button>
        <button id="btn-interview" class="action-btn interview-btn" aria-label="Interview mode" title="Interview mode">
          <div class="btn-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2"/><rect x="13" y="11" width="7" height="5" rx="1" fill="currentColor" opacity="0.25"/><circle cx="8" cy="9" r="2"/><path d="M4 15c0-2 2-3.5 4-3.5s4 1.5 4 3.5"/></svg>
          </div>
          <span>Interview</span>
        </button>
      </div>

      <!-- Security Footer -->
      <div class="security-footer">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        <span>End-to-end on-device processing &middot; No data leaves your phone</span>
      </div>
    </div>
  </div>

  <!-- Settings Panel -->
  <div id="settings-panel" class="settings-panel hidden">
    <div class="settings-backdrop"></div>
    <div class="settings-content">
      <div class="settings-header">
        <h2>Settings</h2>
        <button id="btn-close-settings" class="icon-btn" aria-label="Close settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="settings-body">
        <div class="setting-group">
          <h3>Evidence Metadata</h3>
          <label class="setting-toggle">
            <span>Include GPS location</span>
            <input type="checkbox" id="setting-gps" checked>
            <span class="toggle-slider"></span>
          </label>
          <label class="setting-toggle">
            <span>Include date/time</span>
            <input type="checkbox" id="setting-datetime" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-group">
          <h3>Voice Distortion</h3>
          <div class="setting-options">
            <label class="radio-option">
              <input type="radio" name="distortion" value="off" checked> Off
            </label>
            <label class="radio-option">
              <input type="radio" name="distortion" value="subtle"> Subtle
            </label>
            <label class="radio-option">
              <input type="radio" name="distortion" value="medium"> Medium
            </label>
            <label class="radio-option">
              <input type="radio" name="distortion" value="heavy"> Heavy
            </label>
          </div>
        </div>
        <div class="setting-group">
          <h3>Proof Encryption</h3>
          <label class="setting-input">
            <span>Passphrase (optional)</span>
            <input type="password" id="setting-passphrase" placeholder="Encrypt embedded proof data...">
          </label>
          <label class="setting-input">
            <span>Event note (optional)</span>
            <input type="text" id="setting-note" placeholder="e.g., Lhasa protest 2026">
          </label>
        </div>
        <div class="setting-group">
          <h3>About</h3>
          <p class="about-text">Sungma v1.0.0</p>
          <p class="about-text muted">Open-source privacy camera. Zero servers. Zero tracking. Zero data collection. Your camera, your footage, your protection.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Overlay -->
  <div id="preview-overlay" class="preview-overlay hidden">
    <div class="preview-header">
      <span id="preview-title">Captured Photo</span>
      <span id="preview-size" class="preview-size"></span>
    </div>
    <div class="preview-media">
      <img id="preview-image" class="hidden" alt="Captured photo">
      <video id="preview-video" class="hidden" controls></video>
      <audio id="preview-audio" class="hidden" controls></audio>
    </div>
    <div class="preview-actions">
      <button id="btn-save" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Save
      </button>
      <button id="btn-share" class="btn btn-secondary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share
      </button>
      <button id="btn-discard" class="btn btn-danger">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
        Discard
      </button>
    </div>
  </div>

  <!-- Scripts (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection"></script>
  <script src="https://cdn.jsdelivr.net/npm/piexifjs@1.0.6"></script>

  <!-- App Scripts -->
  <script src="js/utils.js"></script>
  <script src="js/camera.js"></script>
  <script src="js/detection.js"></script>
  <script src="js/pixelation.js"></script>
  <script src="js/audio.js"></script>
  <script src="js/recorder.js"></script>
  <script src="js/metadata.js"></script>
  <script src="js/photo.js"></script>
  <script src="js/share.js"></script>
  <script src="js/interview.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
